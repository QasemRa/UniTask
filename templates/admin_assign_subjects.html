{% extends 'base.html' %}
{% load static %}

{% block title %}ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©{% endblock %}

{% block content %}
    <header class="header">
        <div class="header-content">
            <h1>ğŸ“ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <div class="header-user">
                <div class="user-info">
                    <div class="user-avatar">{{ user.username|slice:":1"|upper }}</div>
                    <span>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {{ user.get_full_name|default:user.username }}</span>
                </div>
                <a href="{% url 'logout' %}" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
            </div>
        </div>
    </header>

    <div class="dashboard-layout">
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li>
                    <a href="{% url 'admin_dashboard' %}">
                        <span class="icon">ğŸ“Š</span>
                        <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'admin_add_doctor' %}">
                        <span class="icon">ğŸ‘¨â€ğŸ«</span>
                        <span>Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ±</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'admin_add_student' %}">
                        <span class="icon">ğŸ‘¨â€ğŸ“</span>
                        <span>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'admin_assign_subjects' %}" class="active">
                        <span class="icon">ğŸ“š</span>
                        <span>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'admin_manage_users' %}">
                        <span class="icon">ğŸ‘¥</span>
                        <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="main-content">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                <a href="{% url 'admin_dashboard' %}" class="btn btn-outline" style="padding: 0.5rem 1rem;">
                    â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </a>
                <h1 class="page-title" style="margin-bottom: 0;">ğŸ“š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h1>
            </div>

            {% if messages %}
            <div style="margin-bottom: 2rem;">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}"
                    style="padding: 1rem; background: {% if message.tags == 'success' %}rgba(76, 175, 80, 0.1){% elif message.tags == 'error' %}rgba(244, 67, 54, 0.1){% else %}rgba(255, 152, 0, 0.1){% endif %}; border-radius: 8px; margin-bottom: 1rem; color: {% if message.tags == 'success' %}#4caf50{% elif message.tags == 'error' %}#f44336{% else %}#ff9800{% endif %};">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="upload-card" style="margin-bottom: 2rem;">
                <h3 style="color: var(--text-dark); margin-bottom: 1rem;">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <form method="post" style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap;">
                    {% csrf_token %}
                    <div style="flex: 1; min-width: 200px;">
                        <input type="text" name="subject_name" required 
                               placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©" 
                               style="width: 100%; padding: var(--spacing-sm); border: 2px solid var(--border-gray); border-radius: var(--radius-md);">
                    </div>
                    <div style="flex: 1; min-width: 200px;">
                        <textarea name="subject_description" 
                                  placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø§Ø¯Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" 
                                  style="width: 100%; padding: var(--spacing-sm); border: 2px solid var(--border-gray); border-radius: var(--radius-md); min-height: 40px; resize: vertical;"></textarea>
                    </div>
                    <div style="flex: 1; min-width: 200px;">
                        <select name="doctor_id" required 
                                style="width: 100%; padding: var(--spacing-sm); border: 2px solid var(--border-gray); border-radius: var(--radius-md);">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙƒØªÙˆØ±</option>
                            {% for doctor in doctors %}
                            <option value="{{ doctor.id }}">{{ doctor.get_full_name|default:doctor.username }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" name="action" value="add_subject" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
                </form>
            </div>

            <div class="subjects-section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ“š Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                </div>
                
                {% if subjects %}
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                <th>Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                                <th>Ø§Ù„ÙˆØµÙ</th>
                                <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for subject in subjects %}
                            <tr>
                                <td><strong>{{ subject.name }}</strong></td>
                                <td>
                                    {% if subject.doctor %}
                                        {{ subject.doctor.get_full_name|default:subject.doctor.username }}
                                    {% else %}
                                        <span style="color: #f44336;">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if subject.description %}
                                        {{ subject.description|truncatewords:10 }}
                                    {% else %}
                                        <span style="color: #757575;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ</span>
                                    {% endif %}
                                </td>
                                <td>{{ subject.enrollments.count }}</td>
                                <td>
                                    <form method="post" style="display: inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="subject_id" value="{{ subject.id }}">
                                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                                            <select name="new_doctor_id" 
                                                    style="padding: 0.25rem; border: 1px solid var(--border-gray); border-radius: 4px; font-size: 0.875rem;">
                                                <option value="">Ø§Ø®ØªØ± Ø¯ÙƒØªÙˆØ±</option>
                                                {% for doctor in doctors %}
                                                <option value="{{ doctor.id }}" {% if subject.doctor and subject.doctor.id == doctor.id %}selected{% endif %}>
                                                    {{ doctor.get_full_name|default:doctor.username }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                            <button type="submit" name="action" value="assign_doctor" 
                                                    class="btn-small" 
                                                    style="background: var(--primary-blue);">
                                                ØªØ­Ø¯ÙŠØ«
                                            </button>
                                        </div>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="upload-card">
                    <div style="text-align: center; padding: 2rem; color: #757575;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“š</div>
                        <h3 style="color: #212121; margin-bottom: 0.5rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                        <p>Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù…Ø§Ø¯Ø© Ø¯Ø±Ø§Ø³ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù….</p>
                    </div>
                </div>
                {% endif %}
            </div>

        </main>
    </div>
{% endblock %}
