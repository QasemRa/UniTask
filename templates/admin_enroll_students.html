{% extends 'base.html' %}
{% load static %}

{% block title %}ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©{% endblock %}

{% block content %}
    <header class="header">
        <div class="header-content">
            <h1>ğŸ“ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <div class="header-user">
                <div class="user-info">
                    <div class="user-avatar">{{ user.username|slice:":1"|upper }}</div>
                    <span>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {{ user.get_full_name|default:user.username }}</span>
                </div>
                <a href="{% url 'logout' %}" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
            </div>
        </div>
    </header>

    <div class="dashboard-layout">
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li>
                    <a href="{% url 'admin_dashboard' %}">
                        <span class="icon">ğŸ“Š</span>
                        <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'admin_add_doctor' %}">
                        <span class="icon">ğŸ‘¨â€ğŸ«</span>
                        <span>Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ±</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'admin_add_student' %}">
                        <span class="icon">ğŸ‘¨â€ğŸ“</span>
                        <span>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'admin_assign_subjects' %}">
                        <span class="icon">ğŸ“š</span>
                        <span>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'admin_enroll_students' %}" class="active">
                        <span class="icon">ğŸ“</span>
                        <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'admin_manage_users' %}">
                        <span class="icon">ğŸ‘¥</span>
                        <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="main-content">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                <a href="{% url 'admin_dashboard' %}" class="btn btn-outline" style="padding: 0.5rem 1rem;">
                    â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </a>
                <h1 class="page-title" style="margin-bottom: 0;">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯</h1>
            </div>

            {% if messages %}
            <div style="margin-bottom: 2rem;">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}"
                    style="padding: 1rem; background: {% if message.tags == 'success' %}rgba(76, 175, 80, 0.1){% elif message.tags == 'error' %}rgba(244, 67, 54, 0.1){% else %}rgba(255, 152, 0, 0.1){% endif %}; border-radius: 8px; margin-bottom: 1rem; color: {% if message.tags == 'success' %}#4caf50{% elif message.tags == 'error' %}#f44336{% else %}#ff9800{% endif %};">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="upload-card" style="margin-bottom: 2rem;">
                <h3 style="color: var(--text-dark); margin-bottom: 1rem;">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ ÙÙŠ Ù…Ø§Ø¯Ø©</h3>
                <p style="color: var(--text-gray); margin-bottom: 1rem;">
                    ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ÙŠØ¯ÙˆÙŠØ§Ù‹. Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„Ù…Ø§Ø¯Ø© Ø«Ù… Ø§Ø¶ØºØ· "ØªØ³Ø¬ÙŠÙ„".
                </p>
                
                <form method="post" style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap;">
                    {% csrf_token %}
                    <div style="flex: 1; min-width: 200px;">
                        <select name="student_id" required 
                                style="width: 100%; padding: var(--spacing-sm); border: 2px solid var(--border-gray); border-radius: var(--radius-md);">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨</option>
                            {% for student in students %}
                            <option value="{{ student.id }}">{{ student.get_full_name|default:student.username }} ({{ student.profile.student_id|default:'-' }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div style="flex: 1; min-width: 200px;">
                        <select name="subject_id" required 
                                style="width: 100%; padding: var(--spacing-sm); border: 2px solid var(--border-gray); border-radius: var(--radius-md);">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
                            {% for subject in subjects %}
                            <option value="{{ subject.id }}">{{ subject.name }} ({{ subject.doctor.get_full_name|default:subject.doctor.username|default:'-' }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" name="action" value="enroll" class="btn btn-primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</button>
                </form>
            </div>

            <div class="subjects-section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                </div>
                
                {% if subjects %}
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                <th>Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                                <th>Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for subject in subjects %}
                            <tr>
                                <td><strong>{{ subject.name }}</strong></td>
                                <td>
                                    {% if subject.doctor %}
                                        {{ subject.doctor.get_full_name|default:subject.doctor.username }}
                                    {% else %}
                                        <span style="color: #f44336;">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span style="padding: 0.25rem 0.5rem; background: rgba(33, 150, 243, 0.1); color: #2196f3; border-radius: 4px; font-size: 0.875rem;">
                                        {{ subject.enrollments.count }} Ø·Ø§Ù„Ø¨
                                    </span>
                                </td>
                                <td>
                                    <a href="{% url 'admin_subject_students' subject.id %}" class="btn-small">Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="upload-card">
                    <div style="text-align: center; padding: 2rem; color: #757575;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“š</div>
                        <h3 style="color: #212121; margin-bottom: 0.5rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                        <p>Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§Ø¯ Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† ØµÙØ­Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯.</p>
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="subjects-section" style="margin-top: 2rem;">
                <div class="section-header">
                    <h2 class="section-title">ğŸ‘¨â€ğŸ“ Ø§Ù„Ø·Ù„Ø§Ø¨ ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h2>
                </div>
                
                {% if unenrolled_students %}
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                                <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ</th>
                                <th>Ø§Ù„Ù‚Ø³Ù…</th>
                                <th>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in unenrolled_students %}
                            <tr>
                                <td><strong>{{ student.get_full_name|default:student.username }}</strong></td>
                                <td>{{ student.email }}</td>
                                <td>{{ student.profile.student_id|default:'-' }}</td>
                                <td>{{ student.profile.department|default:'-' }}</td>
                                <td>
                                    <span style="padding: 0.25rem 0.5rem; background: rgba(255, 152, 0, 0.1); color: #ff9800; border-radius: 4px; font-size: 0.875rem;">
                                        {{ student.enrollments.count }} Ù…Ø§Ø¯Ø©
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="upload-card">
                    <div style="text-align: center; padding: 2rem; color: #757575;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">âœ…</div>
                        <h3 style="color: #212121; margin-bottom: 0.5rem;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙˆÙ†</h3>
                        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙˆÙ† ÙÙŠ Ù…ÙˆØ§Ø¯ Ø¯Ø±Ø§Ø³ÙŠØ©.</p>
                    </div>
                </div>
                {% endif %}
            </div>

        </main>
    </div>
{% endblock %}
